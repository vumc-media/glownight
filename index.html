<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>VUMC Kids ‚Äì Glow Night Registration</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: radial-gradient(circle at top, #1b1b3a, #000);
    color: #fff;
    padding: 20px;
    margin: 0;
  }
  .container {
    max-width: 760px;
    margin: auto;
    background: #11183a;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,.6);
  }
  h1,h2,h3 { text-align:center; margin: 8px 0; }
  .event-details {
    background: #1e275a;
    padding: 18px;
    border-radius: 10px;
    margin: 20px 0;
    text-align: center;
  }
  .expect {
    background: #1b2252;
    padding: 15px;
    border-radius: 10px;
    margin: 20px 0;
  }
  .expect li { margin: 6px 0; }
  .highlight { color:#ffcc00; font-weight:bold; }

  .status {
    display:none;
    margin: 15px 0 5px 0;
    padding: 12px;
    border-radius: 10px;
    font-weight: bold;
    white-space: pre-wrap;
  }
  .status.sending { display:block; background:#0b3b5a; }
  .status.success { display:block; background:#0a4d2a; }
  .status.error   { display:block; background:#5a0b0b; }

  label { display:block; margin-top:14px; font-weight:bold; }
  input, select, textarea {
    width:100%;
    padding:10px;
    margin-top:6px;
    border-radius:8px;
    border:none;
    font-size:16px;
  }
  .child {
    background:#222d6b;
    padding:12px;
    margin-top:12px;
    border-radius:10px;
  }

  button {
    width:100%;
    padding:12px;
    margin-top:14px;
    border:none;
    border-radius:8px;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
  }
  .add-btn { background:#00ffd5; color:#000; }
  .submit-btn { background:#ffcc00; color:#000; }
  .fallback-btn { background:#ffffff; color:#000; }

  button:disabled { opacity: 0.6; cursor: not-allowed; }
  footer { text-align:center; margin-top:25px; font-size:14px; opacity:0.85; }

  .small {
    font-size: 13px;
    opacity: 0.85;
    text-align: center;
    margin-top: 10px;
  }
</style>
</head>

<body>
<div class="container">

  <h1>‚ú® VUMC Kids ‚ú®</h1>
  <h2>Glow Night of Fellowship</h2>
  <h3>üéâ Glow Party & Fellowship Night! üéâ</h3>

  <div class="event-details">
    Versailles United Methodist Church invites you to a<br><br>
    <strong class="highlight">Glow Party & Fellowship Night!</strong><br><br>
    as we celebrate together and welcome the new year!<br><br>
    üóì <strong>Evening of the 25th</strong><br>
    ‚è∞ <strong>Begins at 5:00 PM</strong><br>
    üìç <strong>Versailles United Methodist Church</strong><br>
    230 Paynes Mill Road<br><br>
    <span class="highlight">Wear bright colors or white to glow!</span>
  </div>

  <div class="expect">
    <h3>What to Expect</h3>
    <ul>
      <li>‚ú® Glow lights & glowing fun</li>
      <li>ü§ù Fellowship & connection</li>
      <li>üé∂ Music, laughter & celebration</li>
      <li>üòä A joyful night for our church family</li>
    </ul>
  </div>

  <p style="text-align:center;">
    <strong>All are welcome ‚Äî bring a friend and come celebrate with us!</strong>
  </p>

  <hr style="margin:30px 0; border-color:#333;">

  <h2>Register Your Child</h2>

  <div id="statusBox" class="status"></div>

  <form id="glowForm">
    <label>Parent / Guardian Name</label>
    <input type="text" id="parentName" required>

    <label>Parent Mobile Number</label>
    <input type="tel" id="parentPhone" required>

    <div id="children">
      <div class="child">
        <label>Child Name</label>
        <input type="text" class="childName" required>

        <label>Child Age</label>
        <select class="childAge" required>
          <option value="">Select Age</option>
          <option>3</option><option>4</option><option>5</option>
          <option>6</option><option>7</option><option>8</option>
          <option>9</option><option>10</option><option>11</option><option>12</option>
        </select>
      </div>
    </div>

    <button type="button" class="add-btn" id="addChildBtn">‚ûï Add Another Child</button>

    <label>Allergies / Special Notes</label>
    <textarea id="notes" rows="4" placeholder="Food allergies, medical notes, or other important information"></textarea>

    <button type="submit" class="submit-btn" id="submitBtn">Submit Registration</button>

    <div class="small">
      If the app blocks the submit button, use the backup option below.
    </div>

    <button type="button" class="fallback-btn" id="fallbackBtn" style="display:none;">
      Backup: Send Registration by Email
    </button>
  </form>

  <footer>Versailles United Methodist Church ‚Ä¢ VUMC Kids</footer>
</div>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
  // EmailJS keys (yours)
  const EMAILJS_PUBLIC_KEY = "WLPAgp8AV2otpmCqy";
  const EMAILJS_SERVICE_ID = "service_o5t9bw";
  const EMAILJS_TEMPLATE_ID = "template_ncy5k3y";

  const statusBox = document.getElementById("statusBox");
  const submitBtn = document.getElementById("submitBtn");
  const addChildBtn = document.getElementById("addChildBtn");
  const fallbackBtn = document.getElementById("fallbackBtn");
  const form = document.getElementById("glowForm");

  function setStatus(type, msg) {
    statusBox.className = "status " + type;
    statusBox.textContent = msg;
  }

  function buildKidsList() {
    let kids = "";
    document.querySelectorAll(".child").forEach((child) => {
      const name = child.querySelector(".childName")?.value?.trim();
      const age = child.querySelector(".childAge")?.value?.trim();
      kids += `‚Ä¢ ${name} (Age ${age})\n`;
    });
    return kids.trim();
  }

  function addChild() {
    const div = document.createElement("div");
    div.className = "child";
    div.innerHTML = `
      <label>Child Name</label>
      <input type="text" class="childName" required>
      <label>Child Age</label>
      <select class="childAge" required>
        <option value="">Select Age</option>
        <option>3</option><option>4</option><option>5</option>
        <option>6</option><option>7</option><option>8</option>
        <option>9</option><option>10</option><option>11</option><option>12</option>
      </select>
    `;
    document.getElementById("children").appendChild(div);
  }

  addChildBtn.addEventListener("click", addChild);

  // Backup email (mailto) generator
  function openMailtoBackup() {
    const parentName = document.getElementById("parentName").value.trim();
    const parentPhone = document.getElementById("parentPhone").value.trim();
    const kids = buildKidsList();
    const notes = document.getElementById("notes").value.trim();

    const subject = encodeURIComponent(`Glow Night Registration ‚Äì ${parentName || "Parent"}`);
    const body = encodeURIComponent(
`VUMC Kids ‚Äì Glow Night Registration

Event:
Glow Night of Fellowship
Evening of the 25th | Begins at 5:00 PM
Versailles United Methodist Church
230 Paynes Mill Road

Parent / Guardian:
Name: ${parentName}
Mobile: ${parentPhone}

Children Registered:
${kids}

Allergies / Special Notes:
${notes}
`
    );

    window.location.href = `mailto:versaillesumckids@gmail.com?subject=${subject}&body=${body}`;
  }

  fallbackBtn.addEventListener("click", openMailtoBackup);

  // Init EmailJS (may fail in embedded webviews)
  let emailjsReady = false;
  try {
    emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
    emailjsReady = true;
  } catch (e) {
    emailjsReady = false;
  }

  // If EmailJS didn‚Äôt load/initialize, show backup button immediately
  // Also show backup if the library is missing (blocked by embed)
  setTimeout(() => {
    if (!emailjsReady || typeof emailjs === "undefined") {
      fallbackBtn.style.display = "block";
      setStatus("error", "Email submit may be blocked inside the app.\nUse the Backup Email button below.");
    }
  }, 600);

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // If emailjs is blocked, show backup option
    if (typeof emailjs === "undefined" || !emailjsReady) {
      fallbackBtn.style.display = "block";
      setStatus("error", "Email submit is blocked inside the app.\nUse the Backup Email button below.");
      return;
    }

    const payload = {
      parent_name: document.getElementById("parentName").value.trim(),
      parent_phone: document.getElementById("parentPhone").value.trim(),
      children: buildKidsList(),
      notes: document.getElementById("notes").value.trim()
    };

    submitBtn.disabled = true;
    addChildBtn.disabled = true;
    setStatus("sending", "Sending registration‚Ä¶");

    try {
      await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, payload);
      setStatus("success", "‚úÖ Thank you! Your Glow Night registration has been submitted.");
      form.reset();

      // Reset to one child block
      document.getElementById("children").innerHTML = "";
      addChild();

    } catch (err) {
      fallbackBtn.style.display = "block";
      setStatus("error", "‚ùå Submission failed inside the app.\nUse the Backup Email button below.");
      console.error(err);
    } finally {
      submitBtn.disabled = false;
      addChildBtn.disabled = false;
    }
  });
</script>

</body>
</html>
